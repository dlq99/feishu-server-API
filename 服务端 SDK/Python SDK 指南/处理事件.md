# å¤„ç†äº‹ä»¶

é€šè¿‡äº‹ä»¶è®¢é˜…åŠŸèƒ½ï¼Œåº”ç”¨å¯ä»¥åŠæ—¶æ¥æ”¶é£ä¹¦ä¸­èµ„æºæ•°æ®çš„å˜åŒ–ï¼Œå¹¶æ ¹æ®å˜åŒ–æƒ…å†µåšå¯¹åº”çš„ä¸šåŠ¡å¤„ç†ï¼Œè¯¦æƒ…å‚è§äº‹ä»¶æ¦‚è¿°ã€‚åœ¨åº”ç”¨å†…è®¢é˜…äº‹ä»¶æ—¶ï¼Œè¿˜éœ€è¦åœ¨æœ¬åœ°æœåŠ¡ç«¯å»ºç«‹ä¸åº”ç”¨çš„è¿æ¥ï¼Œä»¥ä¾¿æ¥æ”¶äº‹ä»¶æ•°æ®ã€‚æœåŠ¡ç«¯ SDK å°è£…äº†é•¿è¿æ¥æ–¹å¼ï¼Œå¯ä»¥å¿«é€Ÿå»ºç«‹æ•°æ®é€šé“å¤„ç†äº‹ä»¶ï¼›ä½ ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå»º HTTP æœåŠ¡å™¨å¤„ç†äº‹ä»¶ã€‚ä¸¤ç§æ–¹å¼ä»‹ç»å¦‚ä¸‹ï¼š

| è®¢é˜…æ–¹å¼ | ä»‹ç» |
| --- | --- |
| ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶ | è¯¥æ–¹å¼æ˜¯é£ä¹¦ SDK å†…æä¾›çš„èƒ½åŠ›ï¼Œä½ å¯ä»¥é€šè¿‡é›†æˆé£ä¹¦ SDK ä¸å¼€æ”¾å¹³å°å»ºç«‹ä¸€æ¡ WebSocket å…¨åŒå·¥é€šé“ï¼ˆä½ çš„æœåŠ¡å™¨éœ€è¦èƒ½å¤Ÿè®¿é—®å…¬ç½‘ï¼‰ã€‚åç»­å½“åº”ç”¨è®¢é˜…çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¼€æ”¾å¹³å°ä¼šé€šè¿‡è¯¥é€šé“å‘ä½ çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯ã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„ Webhook æ¨¡å¼ï¼Œé•¿è¿æ¥æ¨¡å¼å¤§å¤§é™ä½äº†æ¥å…¥æˆæœ¬ï¼Œå°†åŸå…ˆ 1 å‘¨å·¦å³çš„å¼€å‘å‘¨æœŸé™ä½åˆ° 5 åˆ†é’Ÿã€‚å…·ä½“ä¼˜åŠ¿å¦‚ä¸‹ï¼šæµ‹è¯•é˜¶æ®µæ— éœ€ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ï¼Œé€šè¿‡é•¿è¿æ¥æ¨¡å¼åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å³å¯æ¥æ”¶äº‹ä»¶å›è°ƒã€‚SDK å†…å°è£…äº†é‰´æƒé€»è¾‘ï¼Œåªåœ¨å»ºè¿æ—¶è¿›è¡Œé‰´æƒï¼Œåç»­äº‹ä»¶æ¨é€å‡ä¸ºæ˜æ–‡æ•°æ®ï¼Œæ— éœ€å†å¤„ç†è§£å¯†å’ŒéªŒç­¾é€»è¾‘ã€‚åªéœ€ä¿è¯è¿è¡Œç¯å¢ƒå…·å¤‡è®¿é—®å…¬ç½‘èƒ½åŠ›å³å¯ï¼Œæ— éœ€æä¾›å…¬ç½‘ IP æˆ–åŸŸåã€‚æ— éœ€éƒ¨ç½²é˜²ç«å¢™å’Œé…ç½®ç™½åå•ã€‚ |
| å°†äº‹ä»¶å‘é€è‡³å¼€å‘è€…æœåŠ¡å™¨ | ä¼ ç»Ÿçš„ Webhook æ¨¡å¼ï¼Œè¯¥æ–¹å¼éœ€è¦ä½ æä¾›ç”¨äºæ¥æ”¶äº‹ä»¶æ¶ˆæ¯çš„æœåŠ¡å™¨å…¬ç½‘åœ°å€ã€‚åç»­å½“åº”ç”¨è®¢é˜…çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¼€æ”¾å¹³å°ä¼šå‘æœåŠ¡å™¨çš„å…¬ç½‘åœ°å€å‘é€ HTTP POST è¯·æ±‚ï¼Œè¯·æ±‚å†…åŒ…å«äº‹ä»¶æ•°æ®ã€‚ |




## ï¼ˆæ¨èï¼‰æ–¹å¼ä¸€ï¼šä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶

å¦‚æœäº‹ä»¶è®¢é˜…æ–¹å¼éœ€è¦é€‰æ‹© **ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶**ï¼Œåˆ™éœ€è¦å…ˆä½¿ç”¨ SDK å»ºç«‹ä¸åº”ç”¨çš„è¿æ¥ã€‚æœ¬ç« èŠ‚æä¾›å»ºç«‹é•¿è¿æ¥çš„ç¤ºä¾‹ä»£ç ä¸ä»£ç è§£æï¼Œé€šè¿‡ SDK å»ºç«‹é•¿è¿æ¥ä¹‹åï¼Œä½ æ‰èƒ½åœ¨åº”ç”¨çš„äº‹ä»¶è®¢é˜…æ–¹å¼ä¸­ä¿å­˜ **ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶** æ–¹å¼ã€‚å…³äºåº”ç”¨å†…é…ç½®äº‹ä»¶è®¢é˜…æ–¹å¼çš„ä»‹ç»ï¼Œå‚è€ƒé…ç½®äº‹ä»¶è®¢é˜…æ–¹å¼ã€‚

![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/c5a72c50a0d1caf40bdc8718c911b8cd_MHMSb9cxef.png?height=580&lazyload=true&maxWidth=550&width=1224)
### æ³¨æ„äº‹é¡¹

åœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å·²äº†è§£ä»¥ä¸‹æ³¨æ„äº‹é¡¹ï¼š
- ç›®å‰é•¿è¿æ¥æ¨¡å¼ä»…æ”¯æŒä¼ä¸šè‡ªå»ºåº”ç”¨ã€‚
- ä¸ **å°†äº‹ä»¶å‘é€è‡³å¼€å‘è€…æœåŠ¡å™¨** æ–¹å¼ï¼ˆå³è‡ªå»ºæœåŠ¡å™¨æ–¹å¼ï¼‰çš„è¦æ±‚ç›¸åŒï¼Œé•¿è¿æ¥æ¨¡å¼ä¸‹æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œéœ€è¦åœ¨ 3 ç§’å†…å¤„ç†å®Œæˆï¼Œå¦åˆ™ä¼šè§¦å‘è¶…æ—¶é‡æ¨æœºåˆ¶ã€‚
- æ¯ä¸ªåº”ç”¨æœ€å¤šå»ºç«‹ 50 ä¸ªè¿æ¥ï¼ˆåœ¨é…ç½®é•¿è¿æ¥æ—¶ï¼Œæ¯åˆå§‹åŒ–ä¸€ä¸ª client å°±æ˜¯ä¸€ä¸ªè¿æ¥ï¼‰ã€‚
- é•¿è¿æ¥æ¨¡å¼çš„æ¶ˆæ¯æ¨é€ä¸º **é›†ç¾¤æ¨¡å¼**ï¼Œä¸æ”¯æŒå¹¿æ’­ï¼Œå³å¦‚æœåŒä¸€åº”ç”¨éƒ¨ç½²äº†å¤šä¸ªå®¢æˆ·ç«¯ï¼ˆclientï¼‰ï¼Œé‚£ä¹ˆåªæœ‰å…¶ä¸­éšæœºä¸€ä¸ªå®¢æˆ·ç«¯ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚

### é•¿è¿æ¥ä»£ç 

```python
import lark_oapi as lark

## P2ImMessageReceiveV1 ä¸ºæ¥æ”¶æ¶ˆæ¯ v2.0ï¼›CustomizedEvent å†…çš„ message ä¸ºæ¥æ”¶æ¶ˆæ¯ v1.0ã€‚
def do_p2_im_message_receive_v1(data: lark.im.v1.P2ImMessageReceiveV1) -> None:
    print(f'[ do_p2_im_message_receive_v1 access ], data: {lark.JSON.marshal(data, indent=4)}')

def do_message_event(data: lark.CustomizedEvent) -> None:
    print(f'[ do_customized_event access ], type: message, data: {lark.JSON.marshal(data, indent=4)}')

event_handler = lark.EventDispatcherHandler.builder("", "") \
    .register_p2_im_message_receive_v1(do_p2_im_message_receive_v1) \
    .register_p1_customized_event("è¿™é‡Œå¡«å…¥ä½ è¦è‡ªå®šä¹‰è®¢é˜…çš„ event çš„ keyï¼Œä¾‹å¦‚ out_approval", do_message_event) \
    .build()

def main():
    cli = lark.ws.Client("YOUR_APP_ID", "YOUR_APP_SECRET",
                         event_handler=event_handler,
                         log_level=lark.LogLevel.DEBUG)
    cli.start()

if __name__ == "__main__":
    main()
```

ä»£ç å®ç°è¯´æ˜ï¼š

1. é€šè¿‡ lark.EventDispatcherHandler.builder() åˆå§‹åŒ–äº‹ä»¶å¤„ç†å™¨ï¼ˆevent_handlerï¼‰ï¼Œè¯¥æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°å¿…é¡»å¡«ç©ºå­—ç¬¦ä¸²ã€‚

2. é€šè¿‡ event_handler çš„ `register_{äº‹ä»¶ç‰ˆæœ¬}_{äº‹ä»¶ç±»å‹ æˆ– customized_event}` æ–¹æ³•å¤„ç†ä¸åŒçš„äº‹ä»¶ã€‚

    åœ¨å¼€å‘è€…åå°åº”ç”¨è¯¦æƒ…é¡µæ·»åŠ äº‹ä»¶æ—¶ï¼ˆå…·ä½“æ“ä½œå¯å‚è§æ·»åŠ äº‹ä»¶ï¼‰ï¼Œå¯è·å–äº‹ä»¶çš„ç±»å‹ä¸ç‰ˆæœ¬ä¿¡æ¯ã€‚

	![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/4dbc1cd97d95f1af949354ce3c350461_bidnBwXPPi.png?height=380&lazyload=true&maxWidth=600&width=1666)

	**v2.0 ç‰ˆæœ¬çš„äº‹ä»¶**
    
	- ä½¿ç”¨`data: lark.im.v1.P2ImMessageReceiveV1` æŒ‡å®šæ‰€é€‰äº‹ä»¶ï¼Œå…¶ä¸­ï¼š
    
  		- `lark.im.v1`è¡¨ç¤ºå¯¹åº”çš„ä¸šåŠ¡åŸŸä»¥åŠç‰ˆæœ¬ï¼Œå¯é€šè¿‡äº‹ä»¶ç±»å‹çš„å‰ç¼€è·å–ä¸šåŠ¡åŸŸä»£ç ï¼Œä¾‹å¦‚ `im.message.receive_v1` å¯¹åº”çš„ä¸šåŠ¡åŸŸä»£ç ä¸º `im`ã€‚
    
  		- `P2ImMessageReceiveV1` ä¸­ï¼Œ**P2** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v2.0ï¼Œ**ImMessageReceiveV1** å¯¹åº”äº‹ä»¶ç±»å‹ `im.message.receive_v1`ã€‚

	- ä½¿ç”¨ `.register_p2_im_message_receive_v1()` å¤„ç†äº‹ä»¶ï¼Œå…¶ä¸­ï¼š
    
  		- **p2** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v2.0ã€‚
    
  		- **im_message_receive_v1** å¯¹åº”äº‹ä»¶ç±»å‹ `im.message.receive_v1`ã€‚

	

> **ğŸ“ æ³¨æ„**
> **è¯´æ˜**ï¼šä»£ç ä¸­çš„æ–¹æ³•æ ¼å¼ä¸äº‹ä»¶ç±»å‹ä¸ä¸€è‡´ï¼Œæ³¨æ„ç”„åˆ«æ ¼å¼ä¸Šçš„å·®å¼‚ï¼Œé¿å…å› æ ¼å¼é—®é¢˜å¯¼è‡´ç¨‹åºè¿è¡Œå¤±è´¥ã€‚


    
    **v1.0 ç‰ˆæœ¬çš„äº‹ä»¶**

	- å›ºå®šä½¿ç”¨ `data: lark.CustomizedEvent` æ–¹æ³•ï¼Œè¡¨ç¤ºå¤„ç†è‡ªå®šä¹‰äº‹ä»¶ã€‚
	- ä½¿ç”¨ `.register_p1_customized_event("è¿™é‡Œå¡«å…¥ä½ è¦è‡ªå®šä¹‰è®¢é˜…çš„äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚ out_approval", do_message_event)` å¤„ç†äº‹ä»¶ï¼š
    	- **p1** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v1.0ã€‚
    	- **customized_event** ä¸ºå›ºå®šçš„æ–¹æ³•åç§°ã€‚
    	- customized_event æ–¹æ³•å†…éœ€è¦ä¼ å…¥äº‹ä»¶ Keyï¼ˆString ç±»å‹ï¼‰ï¼Œä¾‹å¦‚å¤–å‡ºå®¡æ‰¹çš„äº‹ä»¶ç±»å‹ä¸º out_approvalã€‚

    
    ä½ ä¹Ÿå¯ä»¥å‚è€ƒä»£ç ç‰‡æ®µæ³¨é‡Šäº†è§£å¦‚ä½•é…ç½®ï¼š
    
    ```python
    ## P2ImMessageReceiveV1ï¼š
    ## P2 å¯¹åº” v2.0 ç‰ˆæœ¬ï¼Œ
    ## ImMessageReceiveV1 å¯¹åº”æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ç±»å‹ im.message.receive_v1ã€‚
    def do_p2_im_message_receive_v1(data: lark.im.v1.P2ImMessageReceiveV1) -> None:
        print(f'[ do_p2_im_message_receive_v1 access ], data: {lark.JSON.marshal(data, indent=4)}')

    ## å¦‚æœæ˜¯ v1.0 ç‰ˆæœ¬äº‹ä»¶ï¼Œéœ€è¦ä½¿ç”¨ lark.CustomizedEvent
    def do_message_event(data: lark.CustomizedEvent) -> None:
        print(f'[ do_customized_event access ], type: message, data: {lark.JSON.marshal(data, indent=4)}')

    event_handler = lark.EventDispatcherHandler.builder("", "") \
        ## register_p2 å¯¹åº” v2.0 ç‰ˆæœ¬ï¼Œ
        ## im_message_receive_v1 å¯¹åº”æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ç±»å‹ im.message.receive_v1ã€‚
        .register_p2_im_message_receive_v1(do_p2_im_message_receive_v1) \
        ## register_p1 å¯¹åº” v1.0 ç‰ˆæœ¬ï¼Œ
        ## å‚æ•°å€¼éœ€è¦ä¼ å…¥äº‹ä»¶ç±»å‹ã€‚ä¾‹å¦‚ out_approval
        .register_p1_customized_event("è¿™é‡Œå¡«å…¥ä½ è¦è‡ªå®šä¹‰è®¢é˜…çš„ event çš„ keyï¼Œä¾‹å¦‚ out_approval", do_message_event) \
        .build()
    ```

3. é€šè¿‡ lark.ws.Client() åˆå§‹åŒ–é•¿è¿æ¥å®¢æˆ·ç«¯ï¼Œå¿…å¡«å‚æ•°ä¸ºåº”ç”¨çš„ APP_ID å’Œ APP_SECRETï¼Œéœ€ç™»å½•[å¼€å‘è€…åå°](https://open.feishu.cn/app)ï¼Œåœ¨åº”ç”¨è¯¦æƒ…é¡µçš„ **å‡­è¯ä¸åŸºç¡€ä¿¡æ¯** > **åº”ç”¨å‡­è¯** åŒºåŸŸè·å–ã€‚
    
    ![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/f7f89950be7e57c2760a8b5b1f5e17c9_QVldl2kW9x.png?height=524&lazyload=true&maxWidth=600&width=3594)

4. å¯é€‰å‚æ•°ä¼ å…¥ event_handlerï¼ŒåŒæ—¶å¯è®¾ç½®æ—¥å¿—çº§åˆ«ã€‚
5. é€šè¿‡ cli.start() å¯åŠ¨å®¢æˆ·ç«¯ï¼Œå¦‚è¿æ¥æˆåŠŸï¼Œæ§åˆ¶å°ä¼šæ‰“å° "connected to wss://xxxxx"ï¼Œä¸»çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°è¿›ç¨‹ç»“æŸã€‚
    
    ![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/2085839331117b6f9817482a5493eba6_mDSqdoypa5.png?height=264&lazyload=true&maxWidth=600&width=2488)

## æ–¹å¼äºŒï¼šå°†äº‹ä»¶å‘é€è‡³å¼€å‘è€…æœåŠ¡å™¨

å¦‚æœäº‹ä»¶è®¢é˜…æ–¹å¼é€‰æ‹© **å°†äº‹ä»¶å‘é€è‡³å¼€å‘è€…æœåŠ¡å™¨**ï¼Œåˆ™éœ€è¦è®¾ç½®äº‹ä»¶è¯·æ±‚åœ°å€ï¼Œåç»­åœ¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¼€æ”¾å¹³å°ä¼šå‘è¯¥åœ°å€å‘é€åŒ…å«äº‹ä»¶ JSON æ•°æ®çš„ HTTP POST è¯·æ±‚ã€‚ä¸ºæ­¤ä½ éœ€è¦åœ¨é¡¹ç›®ä¸­å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ï¼Œç„¶åæŠŠ HTTP æœåŠ¡çš„ URL ç»‘å®šåˆ°åº”ç”¨çš„äº‹ä»¶è®¢é˜…ä¸­ï¼Œä»¥æ¥æ”¶äº‹ä»¶ã€‚

æœ¬ç« èŠ‚æä¾›äº†ä½¿ç”¨ flask å¯åŠ¨ httpServer çš„ç¤ºä¾‹ä»£ç ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»– Web æ¡†æ¶ï¼Œåªéœ€å¤„ç† HTTP å‡ºå…¥å‚è½¬æ¢å³å¯ã€‚ä»¥æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ä¸ºä¾‹ï¼Œæ¥æ”¶äº‹ä»¶è®¢é˜…çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```python
from flask import Flask

import lark_oapi as lark
from lark_oapi.adapter.flask import *
from lark_oapi.api.im.v1 import *

app = Flask(__name__)

def do_p2_im_message_receive_v1(data: P2ImMessageReceiveV1) -> None:
    print(lark.JSON.marshal(data))

def do_customized_event(data: lark.CustomizedEvent) -> None:
    print(lark.JSON.marshal(data))

handler = lark.EventDispatcherHandler.builder(lark.ENCRYPT_KEY, lark.VERIFICATION_TOKEN, lark.LogLevel.DEBUG) \
    .register_p2_im_message_receive_v1(do_p2_im_message_receive_v1) \
    .register_p1_customized_event("message", do_customized_event) \
    .build()

@app.route("/event", methods=["POST"])
def event():
    resp = handler.do(parse_req())
    return parse_resp(resp)

if __name__ == "__main__":
    app.run(port=7777)
```

ä»£ç ç‰‡æ®µè§£æï¼š

- äº‹ä»¶å­˜åœ¨ä¸¤ç±»ç»“æ„ï¼Œv1.0 ç‰ˆæœ¬äº‹ä»¶ç»“æ„å’Œ v2.0 ç‰ˆæœ¬äº‹ä»¶ç»“æ„ã€‚åœ¨å¤„ç†äº‹ä»¶éœ€è¦æ³¨æ„æ‰€éœ€çš„æ˜¯å“ªç§äº‹ä»¶ç»“æ„ã€‚åœ¨ä¸ºåº”ç”¨æ·»åŠ äº‹ä»¶æ—¶ï¼Œå¯è·å–äº‹ä»¶ç‰ˆæœ¬å’Œäº‹ä»¶ç±»å‹ä¿¡æ¯ã€‚
    
    ![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/4dbc1cd97d95f1af949354ce3c350461_bidnBwXPPi.png?height=380&lazyload=true&maxWidth=600&width=1666)
   

	**v2.0 ç‰ˆæœ¬çš„äº‹ä»¶**
    
	- ä½¿ç”¨`data: P2ImMessageReceiveV1` æŒ‡å®šæ‰€é€‰äº‹ä»¶ï¼Œ`P2ImMessageReceiveV1` ä¸­ï¼Œ**P2** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v2.0ï¼Œ**ImMessageReceiveV1** å¯¹åº”äº‹ä»¶ç±»å‹ `im.message.receive_v1`ã€‚

	- ä½¿ç”¨ `.register_p2_im_message_receive_v1()` å¤„ç†äº‹ä»¶ï¼Œå…¶ä¸­ï¼š
    
  		- **p2** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v2.0ã€‚
    
  		- **im_message_receive_v1** å¯¹åº”äº‹ä»¶ç±»å‹ `im.message.receive_v1`ã€‚

	

> **ğŸ“ æ³¨æ„**
> **è¯´æ˜**ï¼šä»£ç ä¸­çš„æ–¹æ³•æ ¼å¼ä¸äº‹ä»¶ç±»å‹ä¸ä¸€è‡´ï¼Œæ³¨æ„ç”„åˆ«æ ¼å¼ä¸Šçš„å·®å¼‚ï¼Œé¿å…å› æ ¼å¼é—®é¢˜å¯¼è‡´ç¨‹åºè¿è¡Œå¤±è´¥ã€‚


    
    **v1.0 ç‰ˆæœ¬çš„äº‹ä»¶**

	- å›ºå®šä½¿ç”¨ `data: lark.CustomizedEvent` æ–¹æ³•ï¼Œè¡¨ç¤ºå¤„ç†è‡ªå®šä¹‰äº‹ä»¶ã€‚
	- ä½¿ç”¨ `.register_p1_customized_event("è¿™é‡Œå¡«å…¥ä½ è¦è‡ªå®šä¹‰è®¢é˜…çš„äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚ out_approval", do_message_event)` å¤„ç†äº‹ä»¶ï¼š
    	- **p1** è¡¨ç¤ºäº‹ä»¶ç‰ˆæœ¬ä¸º v1.0ã€‚
    	- **customized_event** ä¸ºå›ºå®šçš„æ–¹æ³•åç§°ã€‚
    	- customized_event æ–¹æ³•å†…éœ€è¦ä¼ å…¥äº‹ä»¶ Keyï¼ˆString ç±»å‹ï¼‰ï¼Œä¾‹å¦‚ `message`ï¼ˆå†å²ç‰ˆæœ¬ **æ¥æ”¶æ¶ˆæ¯v1.0** äº‹ä»¶ï¼‰ã€‚

    
    ä½ ä¹Ÿå¯ä»¥å‚è€ƒä»£ç ç‰‡æ®µæ³¨é‡Šäº†è§£å¦‚ä½•é…ç½®ï¼š
    
    ```python
    ## P2ImMessageReceiveV1ï¼š
    ## P2 å¯¹åº” v2.0 ç‰ˆæœ¬ï¼Œ
    ## ImMessageReceiveV1 å¯¹åº”æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ç±»å‹ im.message.receive_v1ã€‚
    def do_p2_im_message_receive_v1(data: P2ImMessageReceiveV1) -> None:
        print(lark.JSON.marshal(data))

    ## å¦‚æœæ˜¯ v1.0 ç‰ˆæœ¬äº‹ä»¶ï¼Œéœ€è¦ä½¿ç”¨ lark.CustomizedEvent
    def do_customized_event(data: lark.CustomizedEvent) -> None:
        print(lark.JSON.marshal(data))

    handler = lark.EventDispatcherHandler.builder(lark.ENCRYPT_KEY, lark.VERIFICATION_TOKEN, lark.LogLevel.DEBUG) \
        ## register_p2 å¯¹åº” v2.0 ç‰ˆæœ¬ï¼Œ
        ## im_message_receive_v1 å¯¹åº”æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ç±»å‹ im.message.receive_v1ã€‚
        .register_p2_im_message_receive_v1(do_p2_im_message_receive_v1) \
        ## register_p1 å¯¹åº” v1.0 ç‰ˆæœ¬ï¼Œ
        ## å‚æ•°å€¼éœ€è¦ä¼ å…¥äº‹ä»¶ç±»å‹ã€‚ä¾‹å¦‚ messageï¼ˆå†å²ç‰ˆæœ¬ æ¥æ”¶æ¶ˆæ¯v1.0 äº‹ä»¶ï¼‰
        .register_p1_customized_event("message", do_customized_event) \
        .build()
    ```

- å¦‚æœä½ åœ¨[å¼€å‘è€…åå°](https://open.feishu.cn/app)çš„åº”ç”¨è¯¦æƒ…ä¸­ï¼Œé…ç½®äº† **äº‹ä»¶ä¸å›è°ƒ** > **åŠ å¯†ç­–ç•¥** é¡µé¢å†…çš„åŠ å¯†ä¿¡æ¯ï¼ˆ**Encrypt Key** å’Œ **Verification** **Token**ï¼‰ã€‚
    
    ![](//sf3-cn.feishucdn.com/obj/open-platform-opendoc/b1b3730ca525a74170d5460167ea2fc8_S6DvzWyGOg.png?height=728&lazyload=true&maxWidth=600&width=2882)
    
    åˆ™å¿…é¡»å°†åŠ å¯†ä¿¡æ¯çš„å€¼ä¼ é€’åˆ° `EventDispatcherHandler.builder` æ–¹æ³•çš„å‚æ•°ä¸­ã€‚

    ```python
    handler = lark.EventDispatcherHandler.builder(lark.ENCRYPT_KEY, lark.VERIFICATION_TOKEN, lark.LogLevel.DEBUG) \
        .register_p2_im_message_receive_v1(do_p2_im_message_receive_v1) \
        .register_p1_customized_event("message", do_customized_event) \
        .build()
    ```

å…¶ä»–äº‹ä»¶ç¤ºä¾‹å‚è§[äº‹ä»¶ç¤ºä¾‹ä»£ç ](https://github.com/larksuite/oapi-sdk-python/blob/v2_main/samples/event)ã€‚
